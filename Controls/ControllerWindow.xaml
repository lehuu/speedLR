<Window x:Class="SpeedLR.Controls.ControllerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpeedLR.Controls"
        xmlns:utils="clr-namespace:SpeedLR.Utils"
        mc:Ignorable="d"
        Focusable="False"
        Background="Transparent"
        SizeToContent="Height"
        Closing="ControllerWindow_Closing" WindowStyle="None" AllowsTransparency="True"
        Topmost="True" ShowInTaskbar="False" MinHeight="400" Height="Auto" Width="400" ResizeMode="NoResize">
	<Window.DataContext>
		<local:ControllerViewModel />
	</Window.DataContext>

	<Window.Resources>
		<utils:EnumToBooleanConverter x:Key="EnumToBool" />
		<utils:ObjectToVisibilityConverter x:Key="ObjectToVis" />
		<utils:EqualityConverter x:Key="EqualityConverter" />
		<utils:ObjectToBoolConverter x:Key="BoolConverter" />
	</Window.Resources>

	<StackPanel Margin="4">
		<StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
			<Button Content="≡" TextElement.FontSize="8pt" HorizontalAlignment="Left" Height="20" VerticalAlignment="Top" Width="20" PreviewMouseDown="DragButton_MouseDown" />
			<Separator Width="10" Opacity="0"/>
			<Button Content="X" HorizontalAlignment="Center" Height="30" VerticalAlignment="Top" Width="30" Click="HideButton_Click"/>
			<Separator Width="10" Opacity="0"/>
			<ToggleButton Content="▼" 
				  IsChecked="{Binding IsPinned}"
				  TextElement.FontSize="8pt" 
				  HorizontalAlignment="Left" 
				  Height="20" 
				  VerticalAlignment="Top" 
				  Width="20" />
		</StackPanel>
		<Separator Height="4" Opacity="0"/>
		<StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
			<ToggleButton Content="+" TextElement.FontSize="8pt" Height="20" Width="20" IsChecked="{Binding StepSize, Converter={StaticResource EnumToBool}, ConverterParameter=Single}" />
			<Separator Width="5" Opacity="0"/>
			<ToggleButton Content="++" TextElement.FontSize="8pt" Height="20" Width="20" IsChecked="{Binding StepSize, Converter={StaticResource EnumToBool}, ConverterParameter=Double}" />
			<Separator Width="5" Opacity="0"/>
			<ToggleButton VerticalContentAlignment="Center" TextElement.FontSize="8pt" Height="20" Width="20" IsChecked="{Binding StepSize, Converter={StaticResource EnumToBool}, ConverterParameter=Triple}">
				<TextBlock LineStackingStrategy="BlockLineHeight" LineHeight="7" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center">+<LineBreak/>++</TextBlock>
			</ToggleButton>
		</StackPanel>
		<Separator Height="6" Opacity="0"/>
		<ComboBox Width="120" Height="20" ItemsSource="{Binding UserMenus}" DisplayMemberPath="Name" SelectedItem="{Binding SelectedMenu, Mode=TwoWay}" />
		<Separator Height="6" Opacity="0"/>
		<ItemsControl ItemsSource="{Binding SelectedMenu.Submenus}">
			<ItemsControl.ItemsPanel>
				<ItemsPanelTemplate>
					<WrapPanel Orientation="Horizontal" Height="30" HorizontalAlignment="Center" />
				</ItemsPanelTemplate>
			</ItemsControl.ItemsPanel>

			<ItemsControl.ItemTemplate>
				<DataTemplate>
					<Button Margin="5,0,5,0" Click="SubmenuButton_Click" Content="{Binding ShortName}">
						<Button.Style>
							<Style TargetType="Button">
								<Setter Property="BorderBrush" Value="Transparent" />
								<Setter Property="BorderThickness" Value="0" />
								<Setter Property="Width" Value="24" />
								<Setter Property="Height" Value="24" />
								<Setter Property="Opacity" Value="0.75"/>
								<Setter Property="FontWeight" Value="Bold"/>
								<Setter Property="Template">
									<Setter.Value>
										<ControlTemplate TargetType="{x:Type Button}">
											<Border x:Name="border" CornerRadius="15" Background="{TemplateBinding Background}" Opacity="{TemplateBinding Opacity}">
												<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
											</Border>
											<ControlTemplate.Triggers>
												<Trigger Property="IsMouseOver"  Value="True">
													<Setter TargetName="border" Property="Opacity" Value="1.0" />
												</Trigger>
											</ControlTemplate.Triggers>
										</ControlTemplate>
									</Setter.Value>
								</Setter>


								<Style.Triggers>
									<DataTrigger Value="True">
										<DataTrigger.Binding>
											<MultiBinding Converter="{StaticResource EqualityConverter}">
												<Binding />
												<Binding Path="DataContext.SelectedSubmenu"
											RelativeSource="{RelativeSource AncestorType=Window}" />
											</MultiBinding>
										</DataTrigger.Binding>

										<Setter Property="Opacity" Value="1.0" />
										<Setter Property="Width" Value="30" />
										<Setter Property="Height" Value="30" />
									</DataTrigger>
								</Style.Triggers>
							</Style>
						</Button.Style>
					</Button>
				</DataTemplate>
			</ItemsControl.ItemTemplate>
		</ItemsControl>


	</StackPanel>
</Window>
